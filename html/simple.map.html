<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./bootstrap.min.css">
    <link rel="stylesheet" href="./maptable.css">
    <script src="./d3.min.js" charset="utf-8"></script>
    <script src="./topojson.min.js"></script>
    <script src="./maptable.js"></script>
    <script type="text/javascript" src="luxon.min.js"></script>
    <script type="text/javascript" src="FileSaver.min.js"></script>
    <title>Teammates</title>
</head>

<body>

    <h1>Teammates</h1>
    <div id="vizContainer" ></div>

    <script>
        const DateTime = luxon.DateTime;
        let timeZones = [];
        let viz = d3.maptable('#vizContainer')
        .csv('./outputFinal.csv')
        .map({
          path: 'countries.json',
          countryIdentifierKey: 'iso_a2',
          countryIdentifierType: 'iso_a2',
          exportSvgClient: true,
          autoFitContent: false,
            title: {
                content: function (countShown, countTotal, filtersDescription, rawData, data) {
                   var out = '';
                   if (countShown === 0 || countTotal === 0) {
                      out = "No data shown";
                   } else if (countShown < countTotal) {
                      out =
                         `Showing <tspan font-weight="bold">${countShown} </tspan> Teammates from
                            <tspan font-weight="bold"> ${countTotal} </tspan>`;
                   } else {
                      out = `<tspan font-weight="bold">${countTotal}</tspan> Teammates`;
                   }
                   if (filtersDescription !== '') out += " â€” " + filtersDescription;
                   if (this.map.dataCountries.length) {
                      var attrProperties = this.map.dataCountries[0].attrProperties.fill;
                      if (attrProperties.key === 'id' && attrProperties.mode === 'count') {
                      } else {
                         var key = attrProperties.columnDetails && attrProperties.columnDetails.title ?
                            attrProperties.columnDetails.title :
                            attrProperties.key;
                         out +=
                            ` - ${modeFormatted[attrProperties.mode]} <tspan font-weight="bold">${key}</tspan> by Country`;
                      }
                   }
                   return out;
                },
            },
          countries: {
            attr: {
                stroke: "#fff",
                "stroke-width": 0.5,
              fill: {
                empty: '#ccc',
                min: '#cceeff',
                max: '#0000FF',
                legend: true,
                aggregate: {
                  mode: 'count',
                  key: 'id',
                }
              },
            },
            tooltip: function(a) {
              out = '<div class="arrow"></div>';
              if (a.values.length === 0) {
                out += '<h3 class="popover-title"> ' + a.properties.name + '</h3>';
                out += '<div class="popover-content">N/A</div>';
              } else {
                out += '<h3 class="popover-title"> ' + a.values[0].Country + '</h3>';
                out += '<div class="popover-content">' + a.values.length+ ' teammates</div>';
              }
              return out;
            },
          },
          markers: false,
        })
        .render();


    </script>


</body>

</html>
